# Бот для анализа прайс-листов поставщиков

Telegram-бот для автоматической обработки и анализа прайс-листов поставщиков пива и напитков.

## Возможности

- Автоматическая обработка Excel файлов (.xlsx, .xls)
- ML-классификация колонок прайс-листов
- Извлечение данных: название, пивоварня, стиль, объем, цена, остатки
- Распознавание всех типов тары: кеги (обычные и ПЭТ), бутылки, банки
- Фильтрация по минимальным остаткам
- Группировка позиций по вариантам тары
- Экспорт данных в текстовый файл
- Управление несколькими проектами

## Требования

- Python 3.13+
- Telegram Bot Token
- Зависимости из `requirements.txt`

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd postavki-bot
```

2. Создайте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env`:
```bash
cp .env.example .env
```

5. Добавьте ваш Telegram Bot Token в `.env`:
```
TELEGRAM_BOT_TOKEN=your_token_here
```

6. Обучите ML-модель:
```bash
python -m ml.train_detector
```

## Запуск

```bash
python run_bot.py
```

Или используйте скрипт:
```bash
./start_bot.sh
```

## Структура проекта

```
postavki-bot/
├── bot/                    # Telegram бот
│   ├── handlers/          # Обработчики команд
│   ├── keyboards/         # Клавиатуры
│   └── states.py          # FSM состояния
├── core/                  # Основная логика
│   ├── parser.py         # Парсер Excel
│   ├── column_detector.py # ML-классификатор колонок
│   ├── filters.py        # Извлечение данных
│   └── order_builder.py  # Формирование отчетов
├── database/              # База данных
│   ├── models.py         # SQLAlchemy модели
│   └── crud.py           # CRUD операции
├── ml/                    # ML модели
│   ├── train_detector.py # Обучение модели
│   └── models/           # Обученные модели
├── data/                  # Данные (не в Git)
│   └── projects/         # Проекты пользователей
├── tests/                 # Тесты
└── config.py             # Конфигурация
```

## Использование

1. Отправьте `/start` боту
2. Создайте новый проект
3. Загрузите Excel файл с прайс-листом
4. Нажмите "Анализировать"
5. Получите результаты через "Показать данные"

## Фильтрация

- **Банки и бутылки**: показываются только при остатке >= 10 штук
- **Кеги**: показываются всегда, без ограничений по остаткам

## Поддерживаемые форматы

Бот автоматически распознает следующие колонки:
- Пивоварня / Производитель
- Название / Наименование
- Стиль / Сорт
- Объем / Тип тары / Литраж
- Цена (за шт, за литр)
- Остаток в штуках / Наличие

## Разработка

### Запуск тестов

```bash
pytest
```

### Переобучение ML-модели

```bash
PYTHONPATH=. python -m ml.train_detector
```

## Безопасность

Проект настроен для конфиденциальности:
- `.env` файл с токенами не попадает в Git
- База данных не попадает в Git
- Загруженные файлы пользователей не попадают в Git
- ML модели можно переобучить локально

## Лицензия

MIT

## Автор

Проект создан для автоматизации работы с прайс-листами поставщиков.
